
#+TITLE: Entities
#+AUTHOR: VLEAD
#+DATE: [2016-06-07 Tue]
#+SETUPFILE: ../../org-templates/level-2.org
#+TAGS: boilerplate(b)
#+EXCLUDE_TAGS: boilerplate
#+OPTIONS: ^:nil

* Introduction

In the object implementation of the Outreach Portal, 
all entities are Objects.  In addition, there is an object 
called =System= that holds the state of the application 
(=user-set=, =session-set=, etc.).

Each of the entities of the data model is implemented as
an object.  Each entity is defined via a class definition, a
constructor and getter and setter methods that access and
mutate the fields of the entity. 

The main idea in the object model is that certain relations
of the data model (those that are total functions) are
implemented as /fields/.  For example the =User= object has
a field called =email= that holds an object of type =Email=.

As a start, we do not implement all relations of the data
model.  For example, the relation =user: Email > User?= is
not implemented.  It should be, if we desire to have an
implementation that is /complete/ with respect to the data
model.  Which elements of the data model are implemented and
which are not are decisions based on the end user
requirements of the application.


* Name

=Name= is a value class with type =is_alphabetic_str=.

#+NAME: class_Name
#+begin_src python
Name = ClassTemplate.mk_class("Name", name=is_alphabetic_str)
is_name = is_inst(Name)
check_name = check_pred(is_name)
Name.__eq__ = lambda self, other: \
                  isinstance(other, self.__class__) and \
                  self.get("name") == other.get("name")

#+end_src

*** Test Name
#+NAME: class_TestName
#+BEGIN_SRC python
class TestName(TestCase):
    TESTING = True

    def test_instantiate_name(self):
        print "test_instantiate_name"
        self.assertEqual(is_name(Name(name="Jimi Hendrix")), True)
        self.assertEqual(Name(name="Jimi Hendrix").get("name"), "Jimi Hendrix")
        self.assertRaises(TypeError, Name, name="Jimi 123 Hendrix")

    def test_name_equality(self):
        print "test_name_equality"
        self.assertEqual(Name(name="Jimi Hendrix") == 
                         Name(name="Jimi Hendrix"), 
                         True)

        self.assertEqual(Name(name="Jimi Hendrix") == 
                         Name(name="Bo Didley"), 
                         False)

#+END_SRC


* Email
=Name= is a value class with type =is_email_str=.
#+NAME: class_Email
#+begin_src python
Email = ClassTemplate.mk_class("Email", email=is_email_str)

Email.__eq__ = lambda self, other: \
                  isinstance(other, self.__class__) and \
                  self.get("email") == other.get("email")

is_email = is_inst(Email)
check_email = check_pred(is_email)

#+end_src

** Test Email
#+NAME: class_TestEmail
#+BEGIN_SRC python
class TestEmail(TestCase):
    TESTING = True

    def test_instantiate_email(self):
        print "test_instantiate_email"
        self.assertEqual(is_email(Email(email="jimi@gnu.org")), True)
        self.assertEqual(Email(email="jimi@gnu.org").get("email"),
                             "jimi@gnu.org")
        self.assertRaises(TypeError, Name, name="jimi@@gnu.org")


    def test_equality_of_email(self):
        print "test_equality_of_email"
        self.assertEqual(Email(email="jimi@gnu.org") ==
                             Email(email="jimi@gnu.org"), True)
        
        self.assertEqual(Email(email="didley@gnu.org") ==
                             Email(email="jimi@gnu.org"), False)

#+END_SRC

* is_nctarget
#+NAME: is_nctarget
#+BEGIN_SRC pytho
def is_nctarget(value):
    if value == None or is_nct(value):
        return True
    else:
        return False
#+END_SRC
* is_octarget
#+NAME: is_octarget
#+BEGIN_SRC python
def is_octarget(value):
    if value == None or is_oct(value):
        return True
    else:
        return False

#+END_SRC
* WSTarget
#+NAME: class_WSTarget
#+BEGIN_SRC python
WSTarget = ClassTemplate.mk_class("WSTarget", usage = is_int, participants = is_int, experiments = is_int, date = is_date, nc_target = is_nctarget)

WSTarget.__eq__ = lambda self, other: \
                  isinstance(other, self.__class__) and \
                  self.get("usage") == other.get("usage") and \
                  self.get("participants") == other.get("participants") and \
                  self.get("experiments") == other.get("experiments") and \
                  self.get("date") == other.get("date") and \
                  self.get("nc_target") == other.get("nc_target")
                  

is_wst = is_inst(WSTarget)
check_wstarget = check_pred(is_wst)

#+END_SRC

** Test WSTarget
#+NAME: class_TestWSTarget
#+BEGIN_SRC python
class TestWSTarget(TestCase):
    TESTING = True

    def test_instantiate_wstarget(self):
        print "test_instantiate_wstarget"
        wstarget_check = WSTarget(usage = 4000, participants = 200,
        experiments = 20, date = datetime.datetime.strptime("30-06-2016", "%d-%m-%Y").date(), nc_target = None)
        self.assertEqual(is_wst(wstarget_check), True)
        self.assertEqual(wstarget_check.get("participants"), 200)
        self.assertRaises(TypeError, WSTarget, participants="123")

    def test_equality_of_wstarget(self):
        print "test_equality_of_wstarget"
        wstarget1 = WSTarget(usage = 4000, participants = 200,
                                 experiments = 20,
                                 date = datetime.datetime.strptime("30-06-2016", "%d-%m-%Y").date(),
                                 nc_target = None)
        wstarget2 = WSTarget(usage = 4000, participants = 200,
                                 experiments = 20,
                                 date = datetime.datetime.strptime("30-06-2016", "%d-%m-%Y").date(),
                                 nc_target = None)
        wstarget3 = WSTarget(usage = 4001,
                                 participants = 200,
                                 experiments = 20,
                                 date = datetime.datetime.strptime("30-06-2016", "%d-%m-%Y").date(),
                                 nc_target = None)
        self.assertEqual(wstarget1 == wstarget2, True)
        self.assertEqual(wstarget1 == wstarget3, False)

#+END_SRC


* NCTarget
#+NAME: class_NCTarget
#+BEGIN_SRC python
def are_wstargets(wstargets):
    ret_val = True
    if is_list(wstargets):
        for wst in wstargets:
            if not is_wstarget(wst):
                ret_val = False
    else:
        ret_val = True

    return ret_val


NCTarget = ClassTemplate.mk_class("NCTarget", usage = is_int, date = is_date, wstargets = are_wstargets, oc_target = is_octarget )
NCTarget.__eq__ = lambda self, other: \
                  isinstance(other, self.__class__) and \
                  self.get("usage") == other.get("usage") and \
                  self.get("oc_target") == other.get("oc_target") and \
                  self.get("date") == other.get("date") and \
                  self.get("wstargets") == other.get("wstargets")

is_nct = is_inst(NCTarget)
check_nctarget = check_pred(is_nct)

#+END_SRC

** Test NCTarget
#+NAME: class_TestNCTarget
#+BEGIN_SRC python
class TestNCTarget(TestCase):
    TESTING = True

    def test_instantiate_nctarget(self):
        print "test_instantiate_nctarget"
        date_check = "30-06-2016"
        date_format = "%d-%m-%Y"
        nctarget_check = NCTarget(usage = 300, wstargets = [],  date = datetime.datetime.strptime(date_check, date_format).date(), oc_target = None)
        self.assertEqual(is_nct(nctarget_check), True)
        self.assertEqual(nctarget_check.get("usage"), 300)
        self.assertRaises(TypeError, NCTarget, usage = "abc")
 
    def test_equality_of_nctarget(self):
        print "test_equality_of_nctarget"
        date_check = "30-06-2016"
        date_format = "%d-%m-%Y"
        nctarget1 = NCTarget(usage=300, wstargets = [],  date = datetime.datetime.strptime(date_check, date_format).date(), oc_target = None)
        nctarget2 = NCTarget(usage=300, wstargets = [],  date = datetime.datetime.strptime(date_check, date_format).date(), oc_target = None)
        nctarget3 = NCTarget(usage=301, wstargets = [],  date = datetime.datetime.strptime(date_check, date_format).date(), oc_target = None)
        self.assertEqual(nctarget1 == nctarget2, True)
        self.assertEqual(nctarget1 == nctarget3, False)


#+END_SRC





* OCTarget
#+NAME: class_OCTarget
#+BEGIN_SRC python
def are_nctargets(nctargets):
    ret_val = True
    if is_list(nctargets):
        for nct in nctargets:
            if not is_nctarget(nct):
                ret_val = False
    else:
        ret_val = True

    return ret_val

OCTarget = ClassTemplate.mk_class("OCTarget", usage = is_int, date = is_date, nctargets = are_nctargets )
OCTarget.__eq__ = lambda self, other: \
                  isinstance(other, self.__class__) and \
                  self.get("usage") == other.get("usage") and \
                  self.get("nc_targets") == other.get("nc_targets") and \
                  self.get("date") == other.get("date")

is_oct = is_inst(OCTarget)
check_octarget = check_pred(is_oct)

#+END_SRC

** Test OCTarget
#+NAME: class_TestOCTarget
#+BEGIN_SRC python
class TestOCTarget(TestCase):
    TESTING = True

    def test_instantiate_octarget(self):
        print "test_instantiate_octarget"
        date_check = "30-06-2016"
        date_format = "%d-%m-%Y"
        octarget_check = OCTarget(usage=300, nctargets = [],  date = datetime.datetime.strptime(date_check, date_format).date())
        self.assertEqual(is_oct(octarget_check), True)
        self.assertEqual(octarget_check.get("usage"), 300)
        self.assertRaises(TypeError, OCTarget, usage = "abc")

    def test_equality_of_octarget(self):
        print "test_equality_of_octarget"
        date_check = "30-06-2016"
        date_format = "%d-%m-%Y"
        octarget1 = OCTarget(usage=300, nctargets = [],  date = datetime.datetime.strptime(date_check, date_format).date())
        octarget2 = OCTarget(usage=300, nctargets = [],  date = datetime.datetime.strptime(date_check, date_format).date())
        octarget3 = OCTarget(usage=3001, nctargets = [],  date = datetime.datetime.strptime(date_check, date_format).date())
        self.assertEqual(octarget1 == octarget2, True)
        self.assertEqual(octarget1 == octarget3, False)

#+END_SRC
* OC
  A =OC= entity has fields =name= of type =Name=,
  institute of type =Institute=.

#+NAME: class_OC
#+BEGIN_SRC python
def are_spokes(spo):
    ret_val = True
    if is_list(spo):
	for nc in spo:
	    if not is_nc(nc):
		ret_val = False
    else:
	ret_val = True

    return ret_val

    
OC= ClassTemplate.mk_class("OC",institute=is_institute,spokes=are_spokes, oc_target = is_octarget)

OC.__eq__ = lambda self,other: \
	    isinstance(other, self.__class__) and \
	    self.get("institute") == other.get("institute") and \
            self.get("spokes") == other.get("spokes") and \
            self.get("oc_target") == other.get("oc_target")

def append_spoke(self,spoke):
    if is_nc(spoke):
	spokes = self.get('spokes')
	spokes.append(spoke)
	self.set(spokes=spokes)

def add_oc_target( self, oc_target):
    if is_octarget(oc_target):
        self.set(oc_target = oc_target)


OC.append_spoke = append_spoke
OC.add_oc_target = add_oc_target

is_oc = is_inst(OC)
check_oc = check_pred(is_oc)

def to_client(self):
    return {
	'institute': self.get("institute").to_client()
    }
#+END_SRC

** Test OC

#+NAME: class_TestOC
#+BEGIN_SRC python
class TestOC(TestCase):
    TESTING = True

    def test_instatiate_OC(self):
        print "test_instantiate_OC"
        oc = OC(institute=Institute(name="IIITH",address="Hyderabad"),spokes=[], oc_target = None)

        self.assertEqual(is_oc(oc), True)


    def test_sets_spokes_on_OC(self):
        print "test_sets_spokes_on_oc"
        oc = OC(institute=Institute(name="IIITH",address="Hyderabad"),spokes=[], oc_target = None)

        nc = NC(institute=Institute(name="HCU",address="Hyderabad"), hub=oc, nc_target = None, workshops = [])
        self.assertEqual((nc.get("institute")).get("name"), "HCU")

        oc.set(spokes=[nc])

        self.assertEqual(oc.get('spokes')[0].get("institute").get("name"), "HCU")


    def test_to_client_OC(self):
        print "test_to_client_oc"

        oc = OC(institute=Institute(name="IIITH",address="Hyderabad"),spokes=[], oc_target = None)
        oc_dict =  oc.to_client()

        self.assertEqual("IIITH", oc_dict['institute']['name'])
        self.assertEqual("Hyderabad", oc_dict['institute']['address'])
    
    def test_equality_of_oc(self):
        print "test_equality_of_oc"
        oc1 = OC(institute=Institute(name="IIITH",address="Hyderabad"),spokes=[], oc_target = None)
        oc2 = OC(institute=Institute(name="IIITH",address="Hyderabad"),spokes=[], oc_target = None)
        oc3 = OC(institute=Institute(name="IIT-D",address="Delhi"),spokes=[], oc_target = None)
        self.assertEqual(oc1 == oc2, True)
        self.assertEqual(oc1 == oc3, False)
        
#+END_SRC



* NC
  A =NC= entity has fields =name= of type =Name=,
 institute of type =Institute=.
#+NAME: class_NC
#+BEGIN_SRC python
def are_workshops(wkshps):
    ret_val = True
    if is_list(wkshps):
        for w in wkshps:
            if not is_workshop(w):
                ret_val = False
    else:
        ret_val = True

    return ret_val


    

NC= ClassTemplate.mk_class("NC", institute=is_institute, hub=is_oc, nc_target = is_nctarget, workshops = are_workshops)

NC.__eq__ = lambda self,other: \
	    isinstance(other, self.__class__) and \
	    self.get("institute") == other.get("institute")and \
            self.get("hub") == other.get("hub")and \
            self.get("nc_target") == other.get("nc_target")and \
            self.get("workshops") == other.get("workshops")

def add_nc_target( self, nc_target):
    if is_nctarget(nc_target):
        self.nc_target = nc_target

def add_workshop_to_nc( self, workshop):
    if is_workshop(workshop):
        workshops = self.get("workshops")
        workshops.append(workshop)
        self.set(workshops = workshops)

NC.add_nc_target = add_nc_target
NC.add_workshop_to_nc = add_workshop_to_nc
is_nc = is_inst(NC)
check_nc = check_pred(is_nc)

#+END_SRC

** Test NC

#+NAME: class_TestOC
#+BEGIN_SRC python
class TestNC(TestCase):
    TESTING = True

    def test_instatiate_NC(self):
        print "test_instantiate_NC"
        nc = NC(institute=Institute(name="HCU",address="Hyderabad"), hub=OC(institute=Institute(name="IIITH", address="Hyderabad"),spokes=[], oc_target = None), nc_target = None, workshops = [])

        self.assertEqual(is_nc(nc), True)
        
    def test_equality_of_nc(self):
        print "test_equality_of_nc"
        nc1 = NC(institute=Institute(name="HCU",address="Hyderabad"), hub=OC(institute=Institute(name="IIITH", address="Hyderabad"),spokes=[], oc_target = None), nc_target = None, workshops = [])
        nc2 = NC(institute=Institute(name="HCU",address="Hyderabad"), hub=OC(institute=Institute(name="IIITH", address="Hyderabad"),spokes=[], oc_target = None), nc_target = None, workshops = [])
        nc3 = NC(institute=Institute(name="NITK",address="karnataka"), hub=OC(institute=Institute(name="IIITH", address="Hyderabad"),spokes=[], oc_target = None), nc_target = None, workshops = [])
        self.assertEqual(nc1 == nc2, True)
        self.assertEqual(nc1 == nc3, False)
#+END_SRC


* Role
   =Role= is an entity that has a field =name= which is an alphabetic string

#+NAME: class_Role
#+BEGIN_SRC python
def is_centre_oc(value):
    if value == None or is_oc(value):
        return True
    else:
        return False

def is_centre_nc(value):
    if value == None or is_nc(value):
        return True
    else:
        return False

   
Role = ClassTemplate.mk_class("Role", 
                              name=is_alphabetic_str,
                              centre_oc=is_centre_oc,centre_nc=is_centre_nc)
Role.__eq__ = lambda self,other: \
	    isinstance(other, self.__class__) and \
	    self.get("name") == other.get("name") and \
            self.get('centre_oc') == other.get('centre_oc') and \
            self.get('centre_nc') == other.get('centre_nc')

is_role = is_inst(Role)
check_role = check_pred(is_role)

def are_roles(rls):
    ret_val = True

    if is_list(rls):
        for rl in rls:
            if not is_role(rl):
                ret_val = False
    else:
        ret_val = True

    return ret_val

Role.admin = Role(name="admin",centre_oc=None,centre_nc=None)
Role.reviewer = Role(name="reviewer",centre_oc=None,centre_nc=None)
Role.guest = Role(name="guest",centre_oc=None,centre_nc=None)
Role.noc = Role(name="noc",centre_oc=None,centre_nc=None)
Role.is_admin = lambda role: role.name == 'admin'
Role.is_reviewer = lambda role: role.name == 'reviewer'
Role.is_guest = lambda role: role.guest == 'guest'

#+END_SRC

** Test Role
#+NAME: class_TestRole
#+BEGIN_SRC python
class TestRole(TestCase):
    TESTING = True

    def test_instantiate_role(self):
        print "test_instantiate_role"
        self.assertEqual(is_role(Role(name="admin", centre_oc=None,centre_nc=None)), True)
        a_role = Role(name="admin", centre_oc=None,centre_nc=None)
        self.assertEqual(check_role(a_role), a_role)
        self.assertEqual(Role(name="admin", centre_oc=None,centre_nc=None).get("name"), "admin")
        self.assertRaises(TypeError, Role, name="admin123", centre=None)

    def test_set_and_get_role(self):
        print "test_sets_on_role"
        u_role = Role(name="guest", centre_oc=None,centre_nc=None)
        self.assertEqual(u_role.get("name"), "guest")
        u_role.set(name="admin")
        self.assertEqual(u_role.get("name"), "admin")

    def test_set_and_get_centre(self):
        print "test_set_and_get_centre"
        oc = OC(institute=Institute(name="IIITH", address="Hyderabad"),spokes=[], oc_target = None)
        occ_role = Role(name="OCC", centre_oc=oc,centre_nc=None)
        self.assertEqual(occ_role.get("name"), "OCC")
        self.assertEqual(occ_role.get("centre_oc"), oc)

#+END_SRC


* User
  A =User= entity has fields =name= of type =Name=, =email= of type =Email= and
  role of type =Role=.

#+NAME: class_User
#+BEGIN_SRC python
def is_user_status(s):
    ret_val = True

    if is_str(s) and (s=="active" or s=="inactive"):
        ret_val = True
    else:        
        ret_val = False



    return ret_val



User = ClassTemplate.mk_class("User", 
                              name=is_name, 
                              email=is_email,
                              roles=are_roles,
                              user_status=is_user_status
                              )


User.__eq__ = lambda self, other: \
                  isinstance(other, self.__class__) and \
                  self.get("email") == other.get("email") and \
                  self.get("name") == other.get("name") and \
                  self.get("roles") == other.get("roles") and \
                  self.get("user_status") == other.get("user_status")

def append_role(self,role):
    if is_role(role):
        roles = self.get('roles')
        roles.append(role)
        #self.set(roles=roles)
User.append_role = append_role

is_user = is_inst(User)
check_user = check_pred(is_user)

#+END_SRC

** Test User
#+NAME: class_TestUser
#+BEGIN_SRC python
class TestUser(TestCase):
    TESTING = True

    def test_instantiate_user(self):
        print "test_instantiate_user"
        user = User(name=Name(name="Jimi Hendrix"),
                    email=Email(email="jimi@gnu.org"),
                    roles=[],user_status="active")
        self.assertEqual(is_user(user), True)

    def test_sets_on_user(self):
        print "test_sets_on_user"
        user = User(name=Name(name="Jimi Hendrix"),
                    email=Email(email="jimi@gnu.org"),
                    roles=[Role(name="guest", centre_oc=None,centre_nc=None)],
                    user_status="active"
                   )

        self.assertEqual(user.get("name").get("name"), "Jimi Hendrix")
        self.assertEqual(user.get("email").get("email"), "jimi@gnu.org")
        self.assertEqual(user.get("roles")[0].get("name"), "guest")
        self.assertEqual(user.get("user_status"),"active")
    def test_equality_on_user(self):
        print "test_equality_on_user"
        user1 = User(name=Name(name="Jimi Hendrix"),
                     email=Email(email="jimi@gnu.org"),
                     roles=[],user_status="active"
                    )
        user2 = User(name=Name(name="Jimi Hendrix"),
                     email=Email(email="jimi@gnu.org"),
                     roles=[],user_status="active"
                    )
        user3 = User(name=Name(name="John Roy"),
                     email=Email(email="jimi@gnu.org"),
                     roles=[],user_status="active"
                    )
        self.assertEqual(user1 == user2, True)
        self.assertEqual(user1 == user3, False)
        
    def test_append_role(self):
        print "test_append_role"
        user = User(name=Name(name="Jimi Hendrix"),
                     email=Email(email="jimi@gnu.org"),
                     roles=[],user_status="active")
        user.append_role(Role(name="guest",centre_oc=None,centre_nc=None))
        print user.to_client()
        self.assertTrue(len(user.get('roles'))==1)

#+END_SRC


* Institute

=Institute= is an entity that has two fields =name= which is an alphabetic
string and =address= which is a string

#+NAME: class_Institute
#+BEGIN_SRC python

Institute = ClassTemplate.mk_class("Institute", name=is_alphabetic_str, address=is_str)
is_institute = is_inst(Institute)
check_institute = check_pred(is_institute)

Institute.__eq__ = lambda self, other: \
                  isinstance(other, self.__class__) and \
                  self.get("name") == other.get("name") and \
                  self.get('address') == other.get("address")
                  

def to_client(self):
    return {
	'name': self.get("name"),
        'address': self.get("address")
    }

#+END_SRC

** Test Institute
#+NAME: class_TestInstitute
#+BEGIN_SRC python
class TestInstitute(TestCase):
    TESTING = True

    def test_instantiate_institute(self):
        print "test_instantiate_institute"
        self.assertEqual(is_institute(Institute(name="IIIT",address="Hyderabad")), True)
        institute_ex = Institute(name="IIIT",address="Hyderabad")
        self.assertEqual(check_institute(institute_ex), institute_ex)
        self.assertEqual(check_institute(institute_ex).get("name"), "IIIT")
        self.assertRaises(TypeError, Institute, name="IIIT123")

    def test_equality_on_institute(self):
        print "test_equality_on_institute"
        institute1 = Institute(name="IIIT",address="Hyderabad")
        institute2 = Institute(name="IIIT",address="Hyderabad")
        institute3 = Institute(name="IIT-D",address="Delhi")
        self.assertEqual(institute1 == institute2, True)
        self.assertEqual(institute1 == institute3, False)
#+END_SRC
   

* Status
   =Status= is an entity that has a field =name= which is an alphabetic string

#+NAME: class_Status
#+BEGIN_SRC python
Status = ClassTemplate.mk_class("Status", name=is_alphabetic_str)
Status.__eq__ = lambda self, other: \
                  isinstance(other, self.__class__) and \
                  self.get("name") == other.get("name")

Status.pending = Status(name="pending")
Status.cancelled = Status(name="cancelled")
Status.completed = Status(name="completed")
Status.pending_approval = Status(name="pending for approval")
Status.rejected = Status(name="rejected")
Status.approved = Status(name="approved")

Status.is_pending = lambda status: status.get('name') == 'pending'
Status.is_cancelled = lambda status: status.get('name') == 'cancelled'
Status.is_completed = lambda status: status.get('name') == 'completed'
Status.is_pending_approval = lambda status: status.get('name') == 'pending for approval'
Status.is_rejected = lambda status: status.get('name') == 'rejected'
Status.is_approved = lambda status: status.get('name') == 'approved'


is_status = is_inst(Status)
check_status = check_pred(is_status)

#+END_SRC

** Test Status
#+NAME: class_TestStatus
#+BEGIN_SRC python
class TestStatus(TestCase):
    TESTING = True

    def test_instantiate_status(self):
        print "test_instantiate_status"
        self.assertEqual(is_status(Status(name="completed")), True)
        a_status = Status(name="completed")
        self.assertEqual(check_status(a_status), a_status)
        self.assertEqual(Status(name="completed").get("name"), "completed")
        self.assertRaises(TypeError, Status, name="invalid123")

    def test_set_and_get_status(self):
        print "test_sets_on_status"
        u_status = Status(name="completed")
        self.assertEqual(u_status.get("name"), "completed")
        u_status.set(name="pending for approval")
        self.assertEqual(u_status.get("name"), "pending for approval")

    def test_equality_on_status(self):
        print "test_equality_on_status"
        self.assertEqual(Status(name="completed") == Status(name="completed"), True)
        self.assertEqual(Status(name="completed") == Status(name="pending"), False)
#+END_SRC



* Type
   =Type= is an entity that has a field =name= which is an alphabetic string

#+NAME: class_Type
#+BEGIN_SRC python
Type = ClassTemplate.mk_class("Type", name=is_alphabetic_str)
Type.__eq__ = lambda self, other: \
                  isinstance(other, self.__class__) and \
                  self.get("name") == other.get("name")

Type.photo = Type(name="photo")
Type.feedback = Type(name="feedback")
Type.report = Type(name="report")
Type.attendance = Type(name="attendance")
'''
Status.is_pending = lambda status: status.get('name') == 'pending'
Status.is_cancelled = lambda status: status.get('name') == 'cancelled'
Status.is_completed = lambda status: status.get('name') == 'completed'
Status.is_pending_approval = lambda status: status.get('name') == 'pending for approval'
Status.is_rejected = lambda status: status.get('name') == 'rejected'
Status.is_approved = lambda status: status.get('name') == 'approved'
'''
is_type = is_inst(Type)
check_type = check_pred(is_type)

#+END_SRC

** Test Type
#+NAME: class_TestType
#+BEGIN_SRC python
class TestType(TestCase):
    TESTING = True

    def test_instantiate_type(self):
        print "test_instantiate_type_objects_entities"
        self.assertEqual(is_type(Type(name="photo")), True)
        a_type = Type.photo
        self.assertEqual(check_type(a_type), a_type)
        self.assertRaises(TypeError, Type, name="invalid123")

    def test_set_and_get_type(self):
        print "test_sets_on_type"
        u_type = Type(name="feedback")
        self.assertEqual(u_type.get("name"), "feedback")
        u_type.set(name="photo")
        self.assertEqual(u_type.get("name"), "photo")

    def test_equality_on_type(self):
        print "test_equality_on_type"
        self.assertEqual(Type(name="feedback") == Type(name="feedback"), True)
        self.assertEqual(Type(name="feedback") == Type(name="complaines"), False)
    
#+END_SRC


* Artefact
#+NAME: class_Artefact
#+BEGIN_SRC python
Artefact = ClassTemplate.mk_class("Artefact", 
                                  name = is_alphabetic_str, 
                                  path = is_string,
                                  a_type = is_type )

Artefact.__eq__ = lambda self, other: \
                  isinstance(other, self.__class__) and \
                  self.get("name") == other.get("name") and \
                  self.get("path") == other.get("path") and \
                  self.get("a_type") == other.get("a_type")
                  

is_artefact = is_inst(Artefact)
check_artefact = check_pred(is_artefact)

#+END_SRC

** Test Artefact
#+NAME: class_TestArtefact
#+BEGIN_SRC python
class TestArtefact(TestCase):
    TESTING = True

    def test_instantiate_artefact(self):
        print "test_instantiate_artefact"
        self.assertEqual(is_artefact(Artefact(name="attendance", 
                         path="/home", a_type = Type(name = "attendance")))
                         , True)
        self.assertEqual(Artefact(name="attendance", 
                                  path="/home", 
                                  a_type = Type(name = "attendance")).get("a_type").get("name"),
                         "attendance")
        self.assertRaises(TypeError, Artefact, name="123")

    def test_equality_on_artefact(self):
        print "test_equality_on_artefact"
        artefact1 = Artefact(name="attendance", path="/home", a_type = Type(name = "attendance"))
        artefact2 = Artefact(name="attendance", path="/home", a_type = Type(name = "attendance"))
        artefact3 = Artefact(name="college report", path="/home/vlead", a_type = Type(name = "attendance"))
        self.assertEqual(artefact1 == artefact2, True)
        self.assertEqual(artefact1 == artefact3, False)
        
#+END_SRC




* Workshop
  A workshop is an entity that takes two arguments Institute, and Target.

#+NAME: class_Workshop
#+BEGIN_SRC python

def is_wstarget(value):
    if value == None or is_wst(value):
        return True
    else:
        return False

def are_artefacts(artefacts):
    ret_val = True
    if is_list(artefacts):
        for a in artefacts:
            if not is_artefact(a):
                ret_val = False
    else:
        ret_val = True

    return ret_val


Workshop = ClassTemplate.mk_class("Workshop", 
                                  name=is_name, 
                                  institute=is_institute, 
                                  ws_target = is_wstarget, 
                                  nc = is_nc, 
                                  artefacts = are_artefacts, 
                                  status = is_status,
                                  a_date = is_date,
                                  a_usage = is_int,
                                  a_participants = is_int,
                                  a_experiments = is_int)

Workshop.__eq__ = lambda self, other: \
                  isinstance(other, self.__class__) and \
                  self.get("name") == other.get("name") and \
                  self.get("institute") == other.get("institute") and \
                  self.get("ws_target") == other.get("ws_target") and \
                  self.get("nc") == other.get("nc") and \
                  self.get("artefacts") == other.get("artefacts") and \
                  self.get("status") == other.get("status") and \
                  self.get("a_date") == other.get("a_date") and \
                  self.get("a_usage") == other.get("a_usage") and \
                  self.get("a_participants") == other.get("a_participants") and \
                  self.get("a_experiments") == other.get("a_experiments")

is_wkshp = is_inst(Workshop)
check_workshop = check_pred(is_wkshp)

def is_workshop(value):
    if value == None or is_wkshp(value):
        return True
    else:
        return False


def add_artefact(artefact):
    if is_artefact(artefact):
        artefacts = self.get("artefacts")
        artefacts.append(artefact)
        self.set(artefacts = artefacts)

Workshop.add_artefact = add_artefact


#+END_SRC

** Test Workshop

   Test cases to test workshop entity

#+NAME: class_TestWorkshop
#+BEGIN_SRC python
class TestWorkshop(TestCase):
    TESTING = True
    print "Test create workshop"
    def test_instatiate_Workshop(self):
        print "test_instantiate_workshop"
        status = Status(name = "pending")
        oc = OC(institute=Institute(name="IIITH",address="Hyderabad"), oc_target = None, spokes = [])
        nc1 = NC(institute=Institute(name="IIITH",address="Hyderabad"), hub=oc, nc_target = None, workshops=None)
        oc_target = OCTarget(usage = 400, date = datetime.datetime.strptime("30-06-2016", "%d-%m-%Y").date(), nctargets = [])
        nc_target = NCTarget(usage = 400, date = datetime.datetime.strptime("30-06-2016", "%d-%m-%Y").date(), oc_target = oc_target, wstargets = [])
        wstarget_check = WSTarget(usage = 4000, participants = 200, experiments = 20, date = datetime.datetime.strptime("30-06-2016", "%d-%m-%Y").date(), nc_target = nc_target)
        workshop = Workshop(name=Name(name="Test workshop"), 
                            institute=Institute(name="IIITH",address="Hyderabad"), 
                            nc = nc1, 
                            ws_target = wstarget_check, 
                            status = status, 
                            artefacts = [],
                            a_date = None,
                            a_participants = 0,
                            a_experiments = 0,
                            a_usage = 0)
        self.assertEqual(is_wkshp(workshop), True)
    
    def test_equality_on_workshop(self):
        print "test_equality_on_workshop"
        workshop1 = Workshop(name=Name(name="Test workshop"),
                                 institute=Institute(name="IIITH",address="Hyderabad"), 
                                 nc = nc1, 
                                 ws_target = wstarget_check, 
                                 status = status, 
                                 artefacts = [],
                                 a_date = None,
                                 a_participants = 0,
                                 a_experiments = 0,
                                 a_usage = 0)
        workshop2 = Workshop(name=Name(name="Test workshop"),
                                 institute=Institute(name="IIITH",address="Hyderabad"), 
                                 nc = nc1, 
                                 ws_target = wstarget_check, 
                                 status = status, 
                                 artefacts = [],
                                 a_date = None,
                                 a_participants = 0,
                                 a_experiments = 0,
                                 a_usage = 0)
        workshop3 = Workshop(name=Name(name="Test1 workshop1"),
                                 institute=Institute(name="IIT-D",address="Delhi"), 
                                 nc = nc1, 
                                 ws_target = wstarget_check, 
                                 status = status, 
                                 artefacts = [],
                                 a_date = None,
                                 a_participants = 0,
                                 a_experiments = 0,
                                 a_usage = 0)
        self.assertEqual(workshop1 == workshop2, True)
        self.assertEqual(workshop1 == workshop3, False)
        
#+END_SRC
  

* Session
    A session stores the user information.  The session object defines the set
    of operations allowed by the system.  

#+NAME: class_Session
#+BEGIN_SRC python
Session = ClassTemplate.mk_class("Session", user=is_user, role=is_role)
Session.__eq__ = lambda self, other: \
                  isinstance(other, self.__class__) and \
                  self.get("user") == other.get("user") and \
                  self.get("role") == other.get("role")
is_session = is_inst(Session)
check_session = check_pred(is_session)

#+END_SRC
** Test Session

   Test cases to test Seesion entity

#+NAME: class_TestSession
#+BEGIN_SRC python
class TestSession(TestCase):
    TESTING = True

    def test_instantiate_session(self):
        print "test_instantiate_user"
        user = User(name=Name(name="Jimi Hendrix"),
                    email=Email(email="jimi@gnu.org"),
                    roles=[],user_status="active"
                   )
        role = Role(name="admin", centre_oc=None,centre_nc=None)
        session = Session(user=user, role=role)
        self.assertEqual(is_session(session), True)

    def test_sets_on_session(self):
        print "test_sets_on_session"
        user = User(name=Name(name="Jimi Hendrix"),
                    email=Email(email="jimi@gnu.org"),
                    roles=[],user_status="active"
                   )
        role = Role(name="admin", centre_oc=None,centre_nc=None)
        session = Session(user=user, role=role)

        user = User(name=Name(name="Bo Didley"),
                    email=Email(email="didley@gnu.org"),
                    roles=[],user_status="active"
                   )

        session.set(user=user)
        self.assertEqual(session.get("user").get("email").get("email"),
                         "didley@gnu.org")

    def test_equality_on_session(self):
        print "test_equality_on_session"
        user = User(name=Name(name="Jimi Hendrix"),
                    email=Email(email="jimi@gnu.org"),
                    roles=[],user_status="active"
                   )
        role = Role(name="admin", centre_oc=None,centre_nc=None)
        role1 = Role(name="occ(oc)", centre_oc=None,centre_nc=None)
        session1 = Session(user=user, role=role)
        session2 = Session(user=user, role=role)
        session3 = Session(user=user, role=role1)
        self.assertEqual(session1 == session2, True)
        self.assertEqual(session1 == session3, False)                         

#+END_SRC



   
* Infra                                                         :boilerplate:
  
** sources
*** Imports 
#+name: imports_for_sources
#+BEGIN_SRC python
# -*- coding: utf-8 -*-
from runtime.utils.type_utils import *
from runtime.utils.class_templates import *
from runtime.exceptions.exceptions import *
import datetime
#+end_src


** Tests
*** Imports 
#+name: imports_for_tests
#+BEGIN_SRC python
# -*- coding: utf-8 -*-
import unittest
from unittest import TestCase
from runtime.utils.type_utils import *
from runtime.utils.class_templates import *
from entities import *
import datetime
#+end_src

*** Running tests
#+NAME: run_test_cases
#+BEGIN_SRC python
if __name__ == '__main__':
    unittest.main()

#+END_SRC


* Tangling                                                      :boilerplate:

** sources
#+BEGIN_SRC python :tangle entities.py :eval no :noweb yes
<<imports_for_sources>>
<<class_Name>>
<<class_Email>>
<<class_Institute>>
<<is_nctarget>>
<<is_octarget>>
<<class_WSTarget>>
<<class_NCTarget>>
<<class_OCTarget>>
<<class_OC>>
<<class_NC>>
<<class_Role>>
<<class_User>>
<<class_Session>>
<<class_Status>>
<<class_Type>>
<<class_Artefact>>
<<class_Workshop>>
#+end_src


** tests
#+BEGIN_SRC python :tangle test_entities.py :eval no :noweb yes
<<imports_for_tests>>
<<class_TestName>>
<<class_TestEmail>>
<<class_TestRole>>
<<class_TestUser>>
<<class_TestInstitute>>
<<class_TestOC>>
<<class_TestNC>>
<<class_TestSession>>
<<class_TestWorkshop>>
<<class_TestStatus>>
<<class_TestType>>
<<class_TestArtefact>>
<<class_TestWSTarget>>
<<class_TestNCTarget>>
<<class_TestOCTarget>>
<<run_test_cases>>

#+end_src
